{"mappings":"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","sources":["assets/js/script.js"],"sourcesContent":["// Function to adjust dates to local time by adding the offset\nfunction adjustToLocalTime(dateString) {\n\tconst date = new Date(dateString);\n\tdate.setMinutes(date.getMinutes() + date.getTimezoneOffset()); // Adjusts to local time\n\treturn date;\n}\n\n// Function to calculate the age if the person is still alive\nfunction getAge(birthDate) {\n\tconst birth = adjustToLocalTime(birthDate);\n\tconst today = new Date();\n\n\tlet age = today.getFullYear() - birth.getFullYear();\n\tif (\n\t\ttoday.getMonth() < birth.getMonth() ||\n\t\t(today.getMonth() === birth.getMonth() && today.getDate() < birth.getDate())\n\t) {\n\t\tage--;\n\t}\n\treturn age.toString();\n}\n\n// Function to get the lifespan in the format \"birthYear - deathYear\"\nfunction getLifeSpan(birthDate, deathDate) {\n\tconst birth = adjustToLocalTime(birthDate);\n\tconst death = adjustToLocalTime(deathDate);\n\n\tconst birthYear = birth.getFullYear();\n\tconst deathYear = death.getFullYear();\n\treturn `${birthYear} - ${deathYear}`;\n}\n\nfunction buildParentConnections(data, nodes) {\n\tdata.forEach((person) => {\n\t\tconst node = nodes[person.id - 1];\n\t\tconst motherFirstName = person.motherFirstName.split(\" \")[0];\n\t\tconst fatherFirstName = person.fatherFirstName.split(\" \")[0];\n\n\t\tif (motherFirstName && fatherFirstName) {\n\t\t\t// Find all potential mothers and fathers with matching first names\n\t\t\tconst potentialMothers = data.filter((p) => p.firstName === motherFirstName);\n\t\t\tconst potentialFathers = data.filter((p) => p.firstName === fatherFirstName);\n\n\t\t\t// Identify mother-father pairs that are spouses\n\t\t\tlet mother = null;\n\t\t\tlet father = null;\n\t\t\tfor (let m of potentialMothers) {\n\t\t\t\tfor (let f of potentialFathers) {\n\t\t\t\t\t// Check if the mother-father pair are spouses\n\t\t\t\t\tif (nodes[m.id - 1].pids.includes(f.id)) {\n\t\t\t\t\t\tmother = m;\n\t\t\t\t\t\tfather = f;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (mother && father) break;\n\t\t\t}\n\n\t\t\t// Assign the mother and father IDs if a matching spouse pair is found\n\t\t\tif (mother) node.mid = mother.id;\n\t\t\tif (father) node.fid = father.id;\n\t\t}\n\t});\n\n\t// Sort children by birth date for each parent-child group\n\tdata.forEach((person) => {\n\t\tconst motherFirstName = person.motherFirstName.split(\" \")[0];\n\t\tconst fatherFirstName = person.fatherFirstName.split(\" \")[0];\n\t\tif (motherFirstName && fatherFirstName) {\n\t\t\tlet children = data.filter(\n\t\t\t\t(child) =>\n\t\t\t\t\tchild.motherFirstName &&\n\t\t\t\t\tchild.motherFirstName.split(\" \")[0] === motherFirstName &&\n\t\t\t\t\tchild.fatherFirstName &&\n\t\t\t\t\tchild.fatherFirstName.split(\" \")[0] === fatherFirstName\n\t\t\t);\n\t\t\tchildren.sort((a, b) => new Date(a.birthDate) - new Date(b.birthDate));\n\n\t\t\t// Update children in nodes by order of birth date\n\t\t\tchildren.forEach((child, index) => {\n\t\t\t\tnodes[child.id - 1].siblingOrder = index;\n\t\t\t});\n\t\t}\n\t});\n\n\t// Reorder the nodes array based on sibling order for visualization\n\tnodes.sort((a, b) => (a.siblingOrder || 0) - (b.siblingOrder || 0));\n}\n\nfunction buildSpouseConnections(data, nodes) {\n\t// Build spouse connections\n\tdata.forEach((person) => {\n\t\tif (person.spouseFirstName && person.spouseLastName) {\n\t\t\tconst spouse = data.find((p) => p.firstName === person.spouseFirstName && p.lastName === person.spouseLastName);\n\t\t\tif (spouse) {\n\t\t\t\tnodes[person.id - 1].pids.push(spouse.id); // Connect spouses\n\t\t\t\tnodes[spouse.id - 1].pids.push(person.id); // Ensure both sides are connected\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction buildNodes(data) {\n\tconst nodes = data.map((person) => ({\n\t\tid: person.id,\n\t\tname: `${person.firstName} ${person.lastName}`,\n\t\timg: person.directPhotoUrl.replace(\n\t\t\t\"https://drive.google.com/uc?export=view&id=\",\n\t\t\t\"https://drive.google.com/thumbnail?id=\"\n\t\t),\n\t\tpids: [], // Spouse connections\n\t\tmid: null, // Mother's ID\n\t\tfid: null, // Father's ID\n\t\tage: person.deathDate == \"\" ? \"גיל: \" + getAge(person.birthDate) : getLifeSpan(person.birthDate, person.deathDate),\n\t}));\n\n\treturn nodes;\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tconsole.log(\"Initializing data fetch\");\n\tdocument.getElementById(\"spinner\").style.display = \"block\";\n\n\tconst dataUrl =\n\t\t\"https://script.google.com/macros/s/AKfycbxn2onZqiyTpulQTJsjSWgXDTJYN0bd9vKz4vjiiyMqKWlzRwCgggrM2dC1RZ_miroZBQ/exec\";\n\n\tfetch(dataUrl)\n\t\t.then((response) => {\n\t\t\tconsole.log(`Received response with status: ${response.status}`);\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`Network response was not ok: ${response.statusText}`);\n\t\t\t}\n\t\t\treturn response.json();\n\t\t})\n\t\t.then((data) => {\n\t\t\tconsole.log(\"Fetched data:\", data);\n\t\t\tbuildFamilyTree(data);\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error(\"Fetch error:\", error);\n\t\t\tdocument.getElementById(\"spinner\").style.display = \"none\";\n\t\t});\n});\n\nfunction buildFamilyTree(data) {\n\tdocument.getElementById(\"spinner\").style.display = \"none\";\n\n\t// Assign a unique id for each person\n\tdata.forEach((person, index) => {\n\t\tperson.id = index + 1;\n\t});\n\n\t// Map the data to nodes for FamilyTree.js\n\tconst nodes = buildNodes(data);\n\n\tbuildSpouseConnections(data, nodes);\n\tbuildParentConnections(data, nodes);\n\n\t// temp hard coded fix - need to fix later!\n\tnodes[0][\"pids\"].pop();\n\tnodes[1][\"pids\"].pop();\n\n\t// Initialize FamilyTree.js with custom sibling spacing\n\tnew FamilyTree(document.getElementById(\"tree\"), {\n\t\ttemplate: \"john\",\n\t\tdataSource: nodes,\n\t\tnodeBinding: {\n\t\t\tfield_0: \"name\",\n\t\t\tfield_1: \"age\",\n\t\t\timg_0: \"img\",\n\t\t},\n\t\t// mouseScrool: FamilyTree.action.none,\n\t\tnodes: nodes,\n\t\tenableSearch: false,\n\t\tnodeMouseClick: false,\n\t\tpartnerNodeSeparation: 0,\n\t\tlevelSeparation: 80,\n\t\tminPartnerSeparation: 10,\n\t\tsiblingSeparation: 80\n\n\t});\n\n\tconsole.log(\"Final Nodes:\", nodes)\n}\n\n\n"],"names":[],"version":3,"file":"index.a6d2c788.js.map","sourceRoot":"/__parcel_source_root/"}